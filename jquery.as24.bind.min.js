(function(g){var k=g.attr;g.attr=function(a,c,b,d){var e=this,f=!a.nodeType;if(b===undefined)e=f?a[c]:k(a,c,b,d);else if(f){d=a[c];a[c]=b;g(a).trigger({type:c+"_change",attribute:c,newValue:b,oldValue:d});g(a).trigger({type:"change",attribute:c,newValue:b,oldValue:d})}else k(a,c,b,d);return e};getBindingType=function(a){a=g(a);if(a.length>0){a=a[0];switch(a.nodeName){case "INPUT":switch(a.type){case "hidden":case "password":return"text";case "reset":case "submit":return"button";default:return a.type}case "SELECT":return a.multiple?
"multiselect":"dropdown";case "BUTTON":return"button";case "TEXTAREA":return"text"}}return"property"};bindToView=function(a,c,b){b();g(a).bind(c+"_change",b);return a};bindToProperty=function(a,c,b,d,e){return bindToView(a,c,function(){var f=g(a).attr(c);if(e!==undefined)f=e(f);var h=typeof b==="function"?b(f):g(b);switch(d){case undefined:case "val":h.val(f);break;case "text":h.text(f);break;default:h.attr(d,f)}})};bindToRadio=function(a,c,b,d){return bindToView(a,c,function(){var e=g(a).attr(c);
if(d!==undefined)e=d(e);g(b).attr("checked",false);g(b).filter("[value="+e+"]").attr("checked",true)})};bindToMoreVals=function(a,c,b,d){if(d===undefined)d=function(e){g(b).val(e)};return bindToView(a,c,function(){var e=g(a).attr(c).split(",");d(e)})};bindToCheckBox=function(a,c,b,d){return bindToMoreVals(a,c,b,function(e){g(b).attr("checked",false);g.each(e,function(f,h){if(d!==undefined)h=d(h);g(b).filter("[value="+h+"]").attr("checked",true)})})};bindToMultiSelect=function(a,c,b,d){return bindToMoreVals(a,
c,b,function(e){if(d!==undefined)for(i=0;i<e.length;i++)e[i]=d(e[i]);g(b).val(e)})};bindFromView=function(a,c,b,d){c=typeof c==="function"?c(value):g(c);b();d||(d="change");c.bind(d,b);return a};bindFromProperty=function(a,c,b,d,e,f,h){if(d===undefined)d=b;return bindFromView(a,b,function(){var j=typeof d==="function"?d():g(d);switch(e){case undefined:case "val":j=j.val();break;case "text":j=j.text();break;default:j=j.attr(e)}if(f!==undefined)j=f(j);g(a).attr(c,j)},h)};bindFromRadio=function(a,c,
b,d,e){return bindFromProperty(a,c,b,function(){return g(b).filter(":checked")},"val",d,e)};bindFromButton=function(a,c,b,d,e){b=typeof b==="function"?b():g(b);e||(e="click");b.bind(e,function(){var f=typeof d==="function"?d(this.value):this.value;g(a).attr(c,f)});return a};bindFromCheckBox=function(a,c,b,d,e){return bindFromView(a,b,function(){var f=[];g.each(g(b).filter(":checked"),function(h,j){f[h]=j.value;if(d!==undefined)f[h]=d(f[h])});g(a).attr(c,f.join(","))},e)};bindFromMultiSelect=function(a,
c,b,d,e){return bindFromView(a,b,function(){var f=[];g(b).val()!=null&&g.each(g(b).val(),function(h,j){f[h]=j;if(d!==undefined)f[h]=d(f[h])});g(a).attr(c,f.join(","))},e)};g.fn.extend({getBindingType:getBindingType,dataBind:function(a){var c=a.modelAttribute,b=a.selector,d=a.translateTo,e=a.translateFrom,f=a.domProperty,h=a.initialDataInDom;a=a.eventToBind;switch(getBindingType(b)){case "radio":if(h){bindFromRadio(this,c,b,e,a);bindToRadio(this,c,b,d)}else{bindToRadio(this,c,b,d);bindFromRadio(this,
c,b,e,a)}break;case "checkbox":if(h){bindFromCheckBox(this,c,b,e,a);bindToCheckBox(this,c,b,d)}else{bindToCheckBox(this,c,b,d);bindFromCheckBox(this,c,b,e,a)}break;case "multiselect":if(h){bindFromMultiSelect(this,c,b,e,a);bindToMultiSelect(this,c,b,d)}else{bindToMultiSelect(this,c,b,d);bindFromMultiSelect(this,c,b,e,a)}break;case "button":bindFromButton(this,c,b,e,a);break;case "text":case "dropdown":f||(f="val");default:f||(f="text");if(h){bindFromProperty(this,c,b,b,f,e,a);bindToProperty(this,
c,b,f,d)}else{bindToProperty(this,c,b,f,d);bindFromProperty(this,c,b,b,f,e,a)}}return this}})})(jQuery);
